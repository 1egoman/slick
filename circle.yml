# vim: set autoindent expandtab tabstop=2 shiftwidth=2 syntax=sh :
test:
  override:
    - go test -v ./... # no -race for now, I guess I have races?

deployment:
  release:
    branch: master
    commands:
    - |
      set +e
      RELEASES="$CIRCLE_ARTIFACTS/releases/"
      mkdir -p $RELEASES

      for os in linux darwin; do
        for arch in 386 amd64 arm arm64; do

          echo
          echo "==="
          echo "Building GOOS=${GOOS} GOARCH=${GOARCH}"
          echo "==="

          GOOS="${os}" GOARCH="${arch}" go build -v

          cp slime "$RELEASES/slime-${os}-${arch}"

          echo "Done building GOOS=${GOOS} GOARCH=${GOARCH}"
        done
      done

      ls built_releases/
